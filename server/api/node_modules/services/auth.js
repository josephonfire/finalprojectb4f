const bcrypt = require("bcryptjs");
const { insertUser, findUser } = require("../../data/user.js");

async function registerUser(userData) {
  const { name, foto_url, email, password } = userData;

  // Verifica se usuário existe
  const userExists = await findUser({ email });
  if (userExists) {
    const error = new Error("Usuário já existe!");
    error.status = 400;
    throw error;
  }

  // Hash da senha
  const salt = await bcrypt.genSalt(10);
  const hashedPassword = await bcrypt.hash(password, salt);

  // Monta objeto para inserir
  const newUser = {
    name,
    foto_url,
    email,
    password: hashedPassword,
  };

  // Insere no banco
  const inserted = await insertUser(newUser);
  return inserted;
}

module.exports = { registerUser };
 